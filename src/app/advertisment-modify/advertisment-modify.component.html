<div
*ngIf="!isLoadingPage" 
class="border border-primary rounded padding margin-vertical container">
    <app-error-message *ngIf="isError || isErrorSend">
    </app-error-message>
    <h3 *ngIf="!isError">Edytuj ogłoszenie</h3>
    <form 
    *ngIf="!isError"
    [formGroup]="modifyAdvertismentForm" 
    (ngSubmit)="onSubmit()">
        <div class="form-group">
        <label for="title">Tytuł</label>
        <input type="text"
        class="form-control is-invalid"
        [ngClass]="{'is-invalid' : 
        !modifyAdvertismentForm.get('title').valid &&
        modifyAdvertismentForm.get('title').touched,
        'is-valid' : modifyAdvertismentForm.get('title').valid}"
        id="title"
        formControlName="title"
        >
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('title').errors?.required">
            Pole jest wymagane
        </div>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('title').errors?.minlength">
            Tytuł może mieć minimalnie 10 znaków
        </div>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('title').errors?.maxlength">
            Tytuł może mieć maksymalnie 100 znaków
        </div>
        <div class="valid-feedback">
            OK!
        </div>
        </div>
        <div class="form-group">
            <label for="price">Cena(PLN)</label>
            <input type="number"
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' : 
            !modifyAdvertismentForm.get('price').valid &&
            modifyAdvertismentForm.get('price').touched,
            'is-valid' : modifyAdvertismentForm.get('price').valid}"
            id="price"
            formControlName="price"
            >
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('price').errors?.required">
                Pole jest wymagane
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('price').errors?.min">
                Minimalna możliwa wartość to 0
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('price').errors?.max">
                Maksymalna możliwa wartość to 10000000
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
        <div class="form-group">
        <label for="content">Opis</label>
        <textarea
        rows="9"
        class="form-control is-invalid"
        [ngClass]="{'is-invalid' : 
        !modifyAdvertismentForm.get('content').valid &&
        modifyAdvertismentForm.get('content').touched,
        'is-valid' : modifyAdvertismentForm.get('content').valid}"
        id="content"
        formControlName="content"
        ></textarea>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('content').errors?.required">
            Pole jest wymagane
        </div>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('content').errors?.minlength">
            Opis musi mieć minimalnie 10 znaków
        </div>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('content').errors?.maxlength">
            Opis może mieć maksymalnie 500 znaków
        </div>
        <div class="valid-feedback">
            OK!
        </div>
    </div>
    <div formGroupName="car">
        <div class="form-row">
            <div class="form-group col-md-6"> 
                <label for="brandId">Marka samochodu</label>
                <select
                class="form-control is-invalid"
                [ngClass]="{'is-invalid' :
                !modifyAdvertismentForm.get('car.brandId').valid &&
                modifyAdvertismentForm.get('car.brandId').touched,
                'is-valid' : modifyAdvertismentForm.get('car.brandId').valid}"
                id="brandId"
                formControlName="brandId"
                *ngIf="!isBrandError && !isBrandLoading"
                [value]="selectBrandIndex"
                (change)="onChangeBrand($event.target.value)"
                >
                <option *ngFor="let brand of brands" 
                [value]="brand.id">{{brand.name}}</option>
                </select>
                <div *ngIf="isBrandLoading" 
                style="text-align: center;">
                        <app-spinner
                    [size]="2"></app-spinner>
                </div>
                <div 
                class="alert alert-danger" 
                role="alert"
                *ngIf="isBrandError"
                style="padding: 0 3px; margin: 0" >
                    Coś poszło nie tak
                </div>
                <div class="invalid-feedback"
                    *ngIf="modifyAdvertismentForm.get('car.brandId').errors?.required">
                    Pole jest wymagane
                </div>
                <div class="valid-feedback">
                    OK!
                </div>
            </div>
            <div class="form-group col-md-6">
                <label for="modelId">Model</label>
                <select
                [attr.disabled]="modifyAdvertismentForm.get('car.brandId').invalid ? 
                '' : 
                null"
                class="form-control is-invalid"
                [ngClass]="{'is-invalid' :
                !modifyAdvertismentForm.get('car.modelId').valid &&
                modifyAdvertismentForm.get('car.modelId').touched,
                'is-valid' : modifyAdvertismentForm.get('car.modelId').valid}"
                id="model"
                formControlName="modelId"
                *ngIf="!isCarModelLoading && !isCarModelError"
                >
                <option
                *ngFor="let carModel of carModels"
                [value]="carModel.id">{{carModel.name}}</option>
                </select>
                <div *ngIf="isCarModelLoading" 
                style="text-align: center;">
                        <app-spinner
                    [size]="2"></app-spinner>
                </div>
                <div 
                class="alert alert-danger" 
                role="alert"
                *ngIf="isCarModelError"
                style="padding: 0 3px; margin: 0" >
                    Coś poszło nie tak
                </div>
                <div class="invalid-feedback"
                    *ngIf="modifyAdvertismentForm.get('car.modelId').errors?.required">
                    Pole jest wymagane
                </div>
                <div class="valid-feedback">
                    OK!
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="engine">Pojemność silnika</label>
            <input type="number"
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' : 
            !modifyAdvertismentForm.get('car.engine').valid &&
            modifyAdvertismentForm.get('car.engine').touched,
            'is-valid' : modifyAdvertismentForm.get('car.engine').valid}"
            id="engine"
            formControlName="engine"
            >
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.engine').errors?.required">
                Pole jest wymagane
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.engine').errors?.min">
                Minimalna możliwa wartość to 1
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.engine').errors?.max">
                Maksymalna możliwa wartość to 50 000
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
        <div class="form-group">
            <label for="enginePower">Moc silnika</label>
            <input type="number"
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' : 
            !modifyAdvertismentForm.get('car.enginePower').valid &&
            modifyAdvertismentForm.get('car.enginePower').touched,
            'is-valid' : modifyAdvertismentForm.get('car.enginePower').valid}"
            id="enginePower"
            formControlName="enginePower"
            >
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.enginePower').errors?.required">
                Pole jest wymagane
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.enginePower').errors?.min">
                Minimalna możliwa wartość to 1
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.enginePower').errors?.max">
                Maksymalna możliwa wartość to 20 000
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6"> 
                <label for="fuel">Rodzaj paliwa</label>
                <select
                class="form-control is-invalid"
                [ngClass]="{'is-invalid' :
                !modifyAdvertismentForm.get('car.fuel').valid &&
                modifyAdvertismentForm.get('car.fuel').touched,
                'is-valid' : modifyAdvertismentForm.get('car.fuel').valid}"
                id="fuel"
                formControlName="fuel"
                *ngIf="!isTypeFuelLoading && !isTypeFuelError"
                >
                <option 
                *ngFor="let typeFuel of TypeFuels"
                [value]="typeFuel">{{typeFuel | translateFuel}}</option>
                </select>
                <div *ngIf="isTypeFuelLoading" 
                style="text-align: center;">
                        <app-spinner
                    [size]="2"></app-spinner>
                </div>
                <div 
                class="alert alert-danger" 
                role="alert"
                *ngIf="isTypeFuelError"
                style="padding: 0 3px; margin: 0" >
                    Coś poszło nie tak
                </div>
                <div class="invalid-feedback"
                    *ngIf="modifyAdvertismentForm.get('car.fuel').errors?.required">
                    Pole jest wymagane
                </div>
                <div class="valid-feedback">
                    OK!
                </div>
            </div>
            <div class="form-group col-md-6"> 
                <label for="typeCar">Typ samochodu</label>
                <select
                class="form-control is-invalid"
                [ngClass]="{'is-invalid' :
                !modifyAdvertismentForm.get('car.typeCar').valid &&
                modifyAdvertismentForm.get('car.typeCar').touched,
                'is-valid' : modifyAdvertismentForm.get('car.typeCar').valid}"
                id="typeCar"
                formControlName="typeCar"
                *ngIf="!isTypeCarLoading && !isTypeCarError"
                >
                <option *ngFor="let typeCar of typeCars"
                [value]="typeCar"
                >{{typeCar}}</option>
                </select>
                <div *ngIf="isTypeCarLoading" 
                style="text-align: center;">
                        <app-spinner
                    [size]="2"></app-spinner>
                </div>
                <div 
                class="alert alert-danger" 
                role="alert"
                *ngIf="isTypeCarError"
                style="padding: 0 3px; margin: 0" >
                    Coś poszło nie tak
                </div>
                <div class="invalid-feedback"
                    *ngIf="modifyAdvertismentForm.get('car.typeCar').errors?.required">
                    Pole jest wymagane
                </div>
                <div class="valid-feedback">
                    OK!
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="mileage">Przebieg</label>
            <input type="number"
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' : 
            !modifyAdvertismentForm.get('car.mileage').valid &&
            modifyAdvertismentForm.get('car.mileage').touched,
            'is-valid' : modifyAdvertismentForm.get('car.mileage').valid}"
            id="mileage"
            formControlName="mileage"
            >
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.mileage').errors?.required">
                Pole jest wymagane
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.mileage').errors?.min">
                Minimalna możliwa wartość to 0
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.mileage').errors?.max">
                Maksymalna możliwa wartość to 10 000 000
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
        <div class="form-group">
            <label for="firstRegistration">Pierwsza rejestracja</label>
            <input type="number"
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' : 
            !modifyAdvertismentForm.get('car.firstRegistration').valid &&
            modifyAdvertismentForm.get('car.firstRegistration').touched,
            'is-valid' : modifyAdvertismentForm.get('car.firstRegistration').valid}"
            id="firstRegistration"
            formControlName="firstRegistration"
            >
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.firstRegistration').errors?.required">
                Pole jest wymagane
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.firstRegistration').errors?.min">
                Minimalna możliwa wartość to 1900
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.firstRegistration').errors?.max">
                Maksymalna możliwa wartość to {{currentYear}}
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
        <div class="form-group"> 
            <label for="color">Color</label>
            <select
            class="form-control is-invalid"
            [ngClass]="{'is-invalid' :
            !modifyAdvertismentForm.get('car.color').valid &&
            modifyAdvertismentForm.get('car.color').touched,
            'is-valid' : modifyAdvertismentForm.get('car.color').valid}"
            id="color"
            formControlName="color"
            *ngIf="!isColorError && !isColorLoading"
            >
            <option 
            *ngFor="let color of colors"
            [value]="color"
            >{{color}}</option>
            </select>
            <div *ngIf="isColorLoading" 
            style="text-align: center;">
                    <app-spinner
                [size]="2"></app-spinner>
            </div>
            <div 
            class="alert alert-danger" 
            role="alert"
            *ngIf="isColorError"
            style="padding: 0 3px; margin: 0" >
                Coś poszło nie tak
            </div>
            <div class="invalid-feedback"
                *ngIf="modifyAdvertismentForm.get('car.color').errors?.required">
                Pole jest wymagane
            </div>
            <div class="valid-feedback">
                OK!
            </div>
        </div>
    </div>
        <div class="form-group"> 
        <label for="cityId">Miasto</label>
        <select
        class="form-control is-invalid"
        [ngClass]="{'is-invalid' :
        !modifyAdvertismentForm.get('cityId').valid &&
        modifyAdvertismentForm.get('cityId').touched,
        'is-valid' : modifyAdvertismentForm.get('cityId').valid}"
        id="cityId"
        formControlName="cityId"
        *ngIf="!isCityLoading && !isCityError"
        >
        <option
        *ngFor="let city of cities" 
        [value]="+city.id">{{city.name}}</option>
        </select>
        <div *ngIf="isCityLoading" 
        style="text-align: center;">
                <app-spinner
            [size]="2"></app-spinner>
        </div>
        <div 
        class="alert alert-danger" 
        role="alert"
        *ngIf="isCityError"
        style="padding: 0 3px; margin: 0" >
            Coś poszło nie tak
        </div>
        <div class="invalid-feedback"
            *ngIf="modifyAdvertismentForm.get('cityId').errors?.required">
            Pole jest wymagane
        </div>
        <div class="valid-feedback">
            OK!
        </div>
    </div>
    <div>
        <button 
        class="btn btn-primary"
        type="button"
        (click)="addImage()"
        [disabled]="images?.length >=10"
        >Dodaj zdjęcie</button>
        <div 
        class="card " 
        style="width: 16rem; margin: 10px auto;"
        *ngFor="let image of images; let i = index">
            <button 
            class="form-group"
            [ngClass]="{'is-invalid' : !checkImageIsValid(i),
            'is-valid' : checkImageIsValid(i)}"
            (click)="imageFile.click()"
            type="button"
            >
                <div 
                [ngStyle]="{
                'background-image': getUrl(i)}"
                style="
                min-width: 100%;
                min-height: 100%;
                background-repeat: no-repeat;
                background-position: center center;
                background-size: contain;
                height: 9rem;">
                </div>
            </button>
            <div class="invalid-feedback"
            *ngIf="image.valid?.wrongsizebig === true">
            Zdjęcia jest za duży
            </div>
            <div class="invalid-feedback"
            *ngIf="image.valid?.wrongsizesmall === true">
            Zdjęcia jest za za mały
            </div>
            <div class="invalid-feedback"
            *ngIf="image.valid?.wrongtype === true">
            Zły format zdjęcia.
            </div>
            <div class="valid-feedback">
            OK!
            </div>
            <div 
            class="card-body"
            style="display: flex;">
                    <input 
                    type="radio" 
                    name="isMainImage"
                    [id]="'image'+i"
                    [value]="true" 
                    [checked]="image.mainImage"
                    (click)="onChangeMainImage(i)">
                    <label [for]="'image'+i">
                główne
                    </label>
                <button 
                class="btn btn-danger"
                style="width: 100%;"
                type="button"
                (click)="onDeleteImage(i)"
                >X</button>
                <input
                #imageFile 
                type="file" 
                class="form-control"
                style="display: none;"
                (change)="onImageChange($event, i)"
                accept="image/png, image/jpeg, image/jpg"
                [ngClass]="{'is-invalid' :
                    !checkImageIsValid(i),
                    'is-valid' : checkImageIsValid(i)}"
                >
            </div>
        </div>
    </div>
        <button
        class="btn btn-success top-margin"
        type="submit"
        [disabled]="modifyAdvertismentForm.invalid ||
        !checkImagesIsValid()"
        >
        <span *ngIf="!isLoading; else loading">Wyślij</span>
        <ng-template #loading>
        <app-spinner [size]="1"></app-spinner>
        Wysyłanie...
        </ng-template>
        </button>
    </form>
</div>
<div *ngIf="isLoadingPage">
    <app-spinner></app-spinner>
</div>
<app-modal
    *ngIf="isModal"
    [showAcceptButton]="true"
    [showCancelButton]="false"
    title="Ogłoszenie zostało dodane!!"
    firstAction="Wróć do strony"
    (action)="onModalClick($event)"
>
</app-modal>
